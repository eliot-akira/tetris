(()=>{var U=new function(){this.seed=Math.random(),this.next=function(){return this.gen()/2147483647},this.gen=function(){return this.seed=this.seed*16807%2147483647}};function k(s){s.clearRect(0,0,s.canvas.width,s.canvas.height)}function w(s,t,e,h,o){for(let i=0,l=s.length;i<l;i++)for(let r=0,g=s[i].length;r<g;r++)s[i][r]&&we(i+t,r+e,o!==void 0?o:s[i][r],h)}function we(s,t,e,h){s=s*n.cellSize,s=~~s,t=~~t*n.cellSize-2*n.cellSize,h.drawImage(I,e*n.cellSize,0,n.cellSize,n.cellSize,s,t,n.cellSize,n.cellSize)}function W(s,t,e){e=e||1;let h=[];for(let o=s;o<t;o+=e)h.push(o);return h}function ie(s,t){return(s%t+t)%t}var pe=document.getElementById("settings"),c={DAS:10,ARR:1,Gravity:0,"Soft Drop":31,"Lock Delay":30,Size:0,Sound:0,Volume:100,Block:0,Ghost:1,Grid:1,Outline:0},P={DAS:W(0,31),ARR:W(0,11),Gravity:function(){let s=[];s.push("Auto"),s.push("0G");for(let t=1;t<64;t++)s.push(t+"/64G");for(let t=1;t<=20;t++)s.push(t+"G");return s}(),"Soft Drop":function(){let s=[];for(let t=1;t<64;t++)s.push(t+"/64G");for(let t=1;t<=20;t++)s.push(t+"G");return s}(),"Lock Delay":W(0,101),Size:["Auto","Small","Medium","Large"],Sound:["Off","On"],Volume:W(0,101),Block:["Shaded","Solid","Glossy","Arika","World"],Ghost:["Normal","Colored","Off"],Grid:["Off","On"],Outline:["Off","On"]};var se=class{constructor(){this.grabBag=this.gen()}init(){this.grabBag.push.apply(this.grabBag,this.gen()),this.draw()}next(){let t=this.grabBag.shift();return this.grabBag.length===7&&this.grabBag.push.apply(this.grabBag,this.gen()),this.draw(),t}gen(){return console.log("Preview.gen"),[0,1,2,3,4,5,6].sort(function(){return .5-U.next()})}draw(){k(Q);for(let t=0;t<6;t++)this.grabBag[t]===0||this.grabBag[t]===3?w(y[this.grabBag[t]].tetro,y[this.grabBag[t]].x-3,y[this.grabBag[t]].y+2+t*3,Q):w(y[this.grabBag[t]].tetro,y[this.grabBag[t]].x-2.5,y[this.grabBag[t]].y+2+t*3,Q)}},E=new se;var oe=class{constructor(){}draw(){k(H),this.piece===0||this.piece===3?w(y[this.piece].tetro,y[this.piece].x-3,2+y[this.piece].y,H):w(y[this.piece].tetro,y[this.piece].x-2.5,2+y[this.piece].y,H)}},b=new oe;var ye,le=!0,ae=0,ve={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"Caps Lock",27:"Esc",32:"Space",33:"PgUp",34:"PgDn",35:"End",36:"Home",37:"\u2190",38:"\u2191",39:"\u2192",40:"\u2193",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0kpad",97:"1kpad",98:"2kpad",99:"3kpad",100:"4kpad",101:"5kpad",102:"6kpad",103:"7kpad",104:"8kpad",105:"9kpad",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",173:"-",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},re=document.getElementsByClassName("menu");function S(s){for(let t=0,e=re.length;t<e;t++)re[t].classList.remove("on");s!==void 0&&re[s].classList.add("on")}var B,ne,Se=document.getElementById("controls"),ue=Se.getElementsByTagName("td");for(let s=0,t=ue.length;s<t;s++)ue[s].onclick=function(){B&&(p[B.id]=ne,B.innerHTML=ve[ne]),ne=p[this.id],this.innerHTML="Press key",B=this};addEventListener("keyup",function(s){if(B){for(let t in p)s.keyCode===p[t]&&(p[t]=void 0,document.getElementById(t).innerHTML=p[t]);p[B.id]=s.keyCode,B.innerHTML=ve[s.keyCode],B=0}},!1);var C,fe;function he(){le||ae>=6?(fe?c[C]=c[C]===0?P[C].length-1:c[C]-1:c[C]=c[C]===P[C].length-1?0:c[C]+1,Re(C),le=!1):ae++,ye=setTimeout(he,50)}function j(){Y(),le=!0,ae=0,clearTimeout(ye)}function Ce(){fe=1,C=this.parentNode.id,this.onmouseup=j,this.onmouseout=j,he()}function Le(){fe=0,C=this.parentNode.id,this.onmouseup=j,this.onmouseout=j,he()}function Re(s){document.getElementById(s).getElementsByTagName("span")[0].innerHTML=P[s][c[s]]}for(let s in c){let t=document.createElement("div"),e=document.createElement("b"),h=document.createElement("i"),o=document.createElement("span"),i=document.createElement("i");t.id=s,e.innerHTML=s+":",o.innerHTML=P[s][c[s]],h.className="left",i.className="right",h.onmousedown=Ce,i.onmousedown=Le,pe.appendChild(t),t.appendChild(e),t.appendChild(h),t.appendChild(o),t.appendChild(i)}var de=class{constructor(){this.pos=0,this.lockDelay=0,this.shiftDelay=0,this.arrDelay=0,this.held=!1,this.finesse=0,this.dirty=!1}new(t){this.pos=0,this.tetro=[],this.held=!1,this.finesse=0,this.dirty=!0,n.landed=!1,this.tetro=y[t].tetro,this.kickData=y[t].kickData,this.x=y[t].x,this.y=y[t].y,this.index=t,this.moveValid(0,0,this.tetro)||(n.gameState=9,v.innerHTML="GAME OVER",S(3))}rotate(t){let e=[];if(t===-1)for(let i=this.tetro.length-1;i>=0;i--){e[i]=[];for(let l=0;l<this.tetro.length;l++)e[i][this.tetro.length-1-l]=this.tetro[l][i]}else for(let i=0;i<this.tetro.length;i++){e[i]=[];for(let l=this.tetro.length-1;l>=0;l--)e[i][l]=this.tetro[l][this.tetro.length-1-i]}let h=ie(this.pos,4),o=ie(this.pos+t,4);for(let i=0,l=this.kickData[0].length;i<l;i++)if(this.moveValid(this.kickData[h][i][0]-this.kickData[o][i][0],this.kickData[h][i][1]-this.kickData[o][i][1],e)){this.x+=this.kickData[h][i][0]-this.kickData[o][i][0],this.y+=this.kickData[h][i][1]-this.kickData[o][i][1],this.tetro=e,this.pos=o;break}}checkShift(){f&a.moveLeft&&!(u&a.moveLeft)?(this.shiftDelay=0,this.arrDelay=0,this.shiftReleased=!0,this.shiftDir=-1,this.finesse++):f&a.moveRight&&!(u&a.moveRight)&&(this.shiftDelay=0,this.arrDelay=0,this.shiftReleased=!0,this.shiftDir=1,this.finesse++),this.shiftDir===1&&!(f&a.moveRight)&&u&a.moveRight&&f&a.moveLeft?(this.shiftDelay=0,this.arrDelay=0,this.shiftReleased=!0,this.shiftDir=-1):this.shiftDir===-1&&!(f&a.moveLeft)&&u&a.moveLeft&&f&a.moveRight?(this.shiftDelay=0,this.arrDelay=0,this.shiftReleased=!0,this.shiftDir=1):!(f&a.moveRight)&&u&a.moveRight&&f&a.moveLeft?this.shiftDir=-1:!(f&a.moveLeft)&&u&a.moveLeft&&f&a.moveRight?this.shiftDir=1:(!(f&a.moveLeft)&&u&a.moveLeft||!(f&a.moveRight)&&u&a.moveRight)&&(this.shiftDelay=0,this.arrDelay=0,this.shiftReleased=!0,this.shiftDir=0),this.shiftDir&&(this.shiftReleased?(this.shift(this.shiftDir),this.shiftDelay++,this.shiftReleased=!1):this.shiftDelay<c.DAS?this.shiftDelay++:this.shiftDelay===c.DAS&&c.DAS!==0?(this.shift(this.shiftDir),c.ARR!==0&&this.shiftDelay++):this.arrDelay<c.ARR?this.arrDelay++:this.arrDelay===c.ARR&&c.ARR!==0&&this.shift(this.shiftDir))}shift(t){if(this.arrDelay=0,c.ARR===0&&this.shiftDelay===c.DAS){for(let e=1;e<10;e++)if(!this.moveValid(e*t,0,this.tetro)){this.x+=e*t-t;break}}else this.moveValid(t,0,this.tetro)&&(this.x+=t)}shiftDown(){if(this.moveValid(0,1,this.tetro)){let t=ce[c["Soft Drop"]+1];t>1?this.y+=this.getDrop(t):this.y+=t}}hardDrop(){this.y+=this.getDrop(20),this.lockDelay=c["Lock Delay"]}getDrop(t){let e;for(e=1;e<=t;e++)if(!this.moveValid(0,e,this.tetro))return e-1;return e-1}hold(){let t=b.piece;this.held||(b.piece!==void 0?(b.piece=this.index,this.new(t)):(b.piece=this.index,this.new(E.next())),this.held=!0,b.draw())}moveValid(t,e,h){t=t+this.x,e=Math.floor(e+this.y);for(let o=0;o<h.length;o++)for(let i=0;i<h[o].length;i++)if(h[o][i]&&(t+o<0||t+o>=10||e+i>=22||L.grid[t+o][e+i]))return!1;return this.lockDelay=0,!0}update(){if(this.moveValid(0,1,this.tetro))if(n.landed=!1,c.Gravity){let t=ce[c.Gravity-1];t>1?this.y+=this.getDrop(t):this.y+=t}else this.y+=ge;else if(n.landed=!0,this.y=Math.floor(this.y),this.lockDelay>=c["Lock Delay"])L.addPiece(this.tetro),this.new(E.next());else{let t=1/P["Lock Delay"][c["Lock Delay"]];D.globalCompositeOperation="source-atop",D.fillStyle="rgba(0,0,0,0)",D.fillRect(0,0,M.width,M.height),D.globalCompositeOperation="source-over",this.lockDelay++}}draw(){w(this.tetro,this.x,this.y,D)}drawGhost(){!c.Ghost&&!n.landed?w(this.tetro,this.x,this.y+this.getDrop(22),D,0):c.Ghost===1&&!n.landed&&(D.globalAlpha=.3,w(this.tetro,this.x,this.y+this.getDrop(22),D),D.globalAlpha=1)}},d=new de;var me=class{constructor(){}new(t,e){let h=new Array(t);for(let o=0;o<t;o++)h[o]=new Array(e);this.grid=h}addPiece(t){let e=!1,h=[],o=!1;for(let i=0;i<t.length;i++)for(let l=0;l<t[i].length;l++)t[i][l]&&(this.grid[i+d.x][l+d.y]=t[i][l],(!e||i+d.x<n.column)&&(n.column=i+d.x,e=!0),h.indexOf(l+d.y)===-1&&(h.push(l+d.y),l+d.y>1&&(o=!0)));if(!o){n.gameState=9,v.innerHTML="GAME OVER",S(3);return}h=h.sort(function(i,l){return i-l});for(let i=h[0],l=i+h.length;i<l;i++){let r=0;for(let g=0;g<10;g++)this.grid[g][i]&&r++;if(r===10){n.lines++,A===3&&n.digLines.indexOf(i)!==-1&&n.digLines.splice(n.digLines.indexOf(i),1);for(let g=i;g>=-1;g--)for(let G=0;G<10;G++)this.grid[G][g]=this.grid[G][g-1]}}n.finesse+=d.finesse-De[d.index][d.pos][n.column],n.piecesSet++,n.column=0,_.innerHTML=n.piecesSet,A!==3?z.innerHTML=K-n.lines:z.innerHTML=n.digLines.length,this.draw()}draw(){if(k(O),w(this.grid,0,0,O),c.Outline){let t=~~(n.cellSize/8),e=n.cellSize,h=document.createElement("canvas");h.width=x.width,h.height=x.height;let o=h.getContext("2d");o.fillStyle="rgba(255,255,255,0.5)",o.beginPath();for(let i=0,l=this.grid.length;i<l;i++)for(let r=0,g=this.grid[i].length;r<g;r++)this.grid[i][r]&&(i<9&&!this.grid[i+1][r]&&o.fillRect(i*e+e-t,r*e-2*e,t,e),i>0&&!this.grid[i-1][r]&&o.fillRect(i*e,r*e-2*e,t,e),r<21&&!this.grid[i][r+1]&&o.fillRect(i*e,r*e-2*e+e-t,e,t),this.grid[i][r-1]||o.fillRect(i*e,r*e-2*e,e,t),i<9&&r<21&&(!this.grid[i+1][r]&&!this.grid[i][r+1]?(o.clearRect(i*e+e-t,r*e-2*e+e-t,t,t),o.fillRect(i*e+e-t,r*e-2*e+e-t,t,t)):!this.grid[i+1][r+1]&&this.grid[i+1][r]&&this.grid[i][r+1]&&(o.moveTo(i*e+e,r*e-2*e+e-t),o.lineTo(i*e+e,r*e-2*e+e),o.lineTo(i*e+e-t,r*e-2*e+e),o.arc(i*e+e,r*e-2*e+e,t,3*Math.PI/2,Math.PI,!0))),i<9&&(!this.grid[i+1][r]&&!this.grid[i][r-1]?(o.clearRect(i*e+e-t,r*e-2*e,t,t),o.fillRect(i*e+e-t,r*e-2*e,t,t)):!this.grid[i+1][r-1]&&this.grid[i+1][r]&&this.grid[i][r-1]&&(o.moveTo(i*e+e-t,r*e-2*e),o.lineTo(i*e+e,r*e-2*e),o.lineTo(i*e+e,r*e-2*e+t),o.arc(i*e+e,r*e-2*e,t,Math.PI/2,Math.PI,!1))),i>0&&r<21&&(!this.grid[i-1][r]&&!this.grid[i][r+1]?(o.clearRect(i*e,r*e-2*e+e-t,t,t),o.fillRect(i*e,r*e-2*e+e-t,t,t)):!this.grid[i-1][r+1]&&this.grid[i-1][r]&&this.grid[i][r+1]&&(o.moveTo(i*e,r*e-2*e+e-t),o.lineTo(i*e,r*e-2*e+e),o.lineTo(i*e+t,r*e-2*e+e),o.arc(i*e,r*e-2*e+e,t,Math.PI*2,3*Math.PI/2,!0))),i>0&&(!this.grid[i-1][r]&&!this.grid[i][r-1]?(o.clearRect(i*e,r*e-2*e,t,t),o.fillRect(i*e,r*e-2*e,t,t)):!this.grid[i-1][r-1]&&this.grid[i-1][r]&&this.grid[i][r-1]&&(o.moveTo(i*e+t,r*e-2*e),o.lineTo(i*e,r*e-2*e),o.lineTo(i*e,r*e-2*e+t),o.arc(i*e,r*e-2*e,t,Math.PI/2,Math.PI*2,!0))));o.fill(),O.drawImage(h,0,0)}}},L=new me;var v=document.getElementById("msg"),X=document.getElementById("stats"),z=document.getElementById("line"),_=document.getElementById("piece"),$=document.getElementsByTagName("h3"),F=document.getElementById("hold"),ee=document.getElementById("bgStack"),x=document.getElementById("stack"),M=document.getElementById("active"),J=document.getElementById("preview"),I=document.getElementById("sprite"),H=F.getContext("2d"),xe=ee.getContext("2d"),O=x.getContext("2d"),D=M.getContext("2d"),Q=J.getContext("2d"),m=I.getContext("2d");var Z=[[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[0,0],[0,0],[0,0],[0,0]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]],be=[[[0,0],[-1,0],[2,0],[-1,0],[2,0]],[[-1,0],[0,0],[0,0],[0,-1],[0,2]],[[-1,-1],[1,-1],[-2,-1],[1,0],[-2,0]],[[0,-1],[0,-1],[0,-1],[0,1],[0,-2]]],Te=[[[0,0]],[[0,0]],[[0,0]],[[0,0]]],Be={index:0,x:2,y:-1,kickData:be,tetro:[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]]},Pe={index:1,x:3,y:0,kickData:Z,tetro:[[2,2,0],[0,2,0],[0,2,0]]},Ee={index:2,x:3,y:0,kickData:Z,tetro:[[0,3,0],[0,3,0],[3,3,0]]},Me={index:3,x:4,y:0,kickData:Te,tetro:[[4,4],[4,4]]},ze={index:4,x:3,y:0,kickData:Z,tetro:[[0,5,0],[5,5,0],[5,0,0]]},Ae={index:5,x:3,y:0,kickData:Z,tetro:[[0,6,0],[6,6,0],[0,6,0]]},Ge={index:6,x:3,y:0,kickData:Z,tetro:[[7,0,0],[7,7,0],[0,7,0]]},y=[Be,Pe,Ee,Me,ze,Ae,Ge],De=[[[1,2,1,0,1,2,1],[2,2,2,2,1,1,2,2,2,2],[1,2,1,0,1,2,1],[2,2,2,2,1,1,2,2,2,2]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2,2]],[[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1],[1,2,2,1,0,1,2,2,1]],[[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2],[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2],[2,3,2,1,2,3,3,2,2]],[[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2],[1,2,1,0,1,2,2,1],[2,2,2,1,1,2,3,2,2]]],n={cellSize:void 0,column:void 0,finesse:void 0,lines:void 0,piecesSet:void 0,startPauseTime:void 0,pauseTime:void 0,lastX:void 0,lastY:void 0,lastPos:void 0,landed:void 0,gameState:3,paused:!1,startTime:void 0,digLines:void 0,released:void 0},Ie=.00390625,ge,ce=function(){let s=[];s.push(0);for(let t=1;t<64;t++)s.push(t/64);for(let t=1;t<=20;t++)s.push(t);return s}(),R,K,T,V=!1,N,A,f,u,p={pause:27,moveLeft:37,moveRight:39,moveDown:40,moveUp:38,hardDrop:32,holdPiece:67,rotRight:88,rotLeft:90,rot180:16,retry:81},a={hardDrop:1,moveRight:2,moveLeft:4,moveDown:8,holdPiece:16,rotRight:32,rotLeft:64,rot180:128};function Y(){let s=document.getElementById("a"),t=document.getElementById("b"),e=document.getElementById("c"),h=document.getElementById("content"),o=window.innerHeight-34;~~(o*1.024)>window.innerWidth&&(o=~~(window.innerWidth/1.024)),c.Size===1&&o>602?n.cellSize=15:c.Size===2&&o>602?n.cellSize=30:c.Size===3&&o>902?n.cellSize=45:n.cellSize=Math.max(~~(o/20),10);let{cellSize:l}=n,r=(window.innerHeight-(l*20+2))/2+"px";h.style.padding=r+" 0",X.style.bottom=r,s.style.padding="0 0.5rem "+~~(l/2)+"px",x.width=M.width=ee.width=l*10,x.height=M.height=ee.height=l*20,t.style.width=x.width+"px",t.style.height=x.height+"px",F.width=l*4,F.height=l*2,s.style.width=F.width+"px",s.style.height=F.height+"px",J.width=l*4,J.height=x.height,e.style.width=J.width+"px",e.style.height=t.style.height,v.style.lineHeight=t.style.height,v.style.fontSize=~~(x.width/10)+"px",X.style.fontSize=~~(x.width/11)+"px",document.documentElement.style.fontSize=~~(x.width/16)+"px",X.style.width=s.style.width;for(let g=0,G=$.length;g<G;g++)$[g].style.lineHeight=s.style.height,$[g].style.fontSize=X.style.fontSize;Fe(),c.Grid===1&&Oe(xe),n.gameState===0&&(d.drawGhost(),d.draw(),L.draw(),E.draw(),b.piece&&b.draw())}addEventListener("resize",Y,!1);function q(s){if(s==="replay"?V=!0:(V=!1,T={},T.seed=~~(Math.random()*2147483645)+1,A=s),K=40,n.column=0,f=0,u=0,n.released=255,d.shiftDir=0,d.shiftReleased=!0,n.startPauseTime=0,n.pauseTime=0,n.paused=!1,U.seed=T.seed,N=21,R=0,n.lastPos="reset",L.new(10,22),b.piece=void 0,c.Gravity===0&&(ge=Ie*4),n.startTime=Date.now(),E.init(),n.finesse=0,n.lines=0,n.piecesSet=0,_.innerHTML=n.piecesSet,z.innerHTML=K-n.lines,k(O),k(D),k(H),A===3){n.digLines=[12,13,14,15,16,17,18,19,20,21],z.innerHTML=10,z.innerHTML=10;let t=[];for(let e=0;e<10;e++){let h=~~(U.next()*10);h!==t[e-1]?t.push(h):e--}for(let e=21;e>11;e--)for(let h=0;h<10;h++)t[e-12]!==h&&(L.grid[h][e]=8);L.draw()}S(),n.gameState===3?(n.gameState=2,ke()):n.gameState=2}function He(){n.gameState===0&&(n.paused=!0,n.startPauseTime=Date.now(),v.innerHTML="PAUSED",S(4))}function te(){n.paused=!1,n.pauseTime+=Date.now()-n.startPauseTime,v.innerHTML="",S()}function Oe(s){s.clearRect(0,0,s.canvas.width,s.canvas.height),s.fillStyle="#343434";for(let t=-1;t<s.canvas.width+1;t+=n.cellSize)s.fillRect(t,0,2,s.canvas.height);for(let t=-1;t<s.canvas.height+1;t+=n.cellSize)s.fillRect(0,t,s.canvas.width,2)}function Fe(){let s=[["#c1c1c1","#dddddd","#a6a6a6","#8b8b8b"],["#25bb9b","#4cd7b6","#009f81","#008568"],["#3397d9","#57b1f6","#007dbd","#0064a2"],["#e67e23","#ff993f","#c86400","#a94b00"],["#efc30f","#ffdf3a","#d1a800","#b38e00"],["#9ccd38","#b9e955","#81b214","#659700"],["#9c5ab8","#b873d4","#81409d","#672782"],["#e64b3c","#ff6853","#c62c25","#a70010"],["#898989","#a3a3a3","#6f6f6f","#575757"]],t=[["#ffffff","#ffffff","#ffffff","#888888","#4d4d4d"],["#7bffdf","#9fffff","#ccffff","#008165","#00442e"],["#6cdcff","#93feff","#c2ffff","#00629f","#002c60"],["#ffc166","#ffe386","#ffffb0","#aa4800","#650500"],["#ffff6a","#ffff8c","#ffffb8","#b68a00","#714f00"],["#efff81","#ffffa2","#ffffcd","#6b9200","#2c5600"],["#dc9dfe","#ffbeff","#ffe9ff","#5d287e","#210043"],["#ff9277","#ffb497","#ffe0bf","#a7000a","#600000"],["#cbcbcb","#ededed","#ffffff","#545454","#1f1f1f"]],e=[["#7b7b7b","#303030","#6b6b6b","#363636"],["#f08000","#a00000","#e86008","#b00000"],["#00a8f8","#0000b0","#0090e8","#0020c0"],["#f8a800","#b84000","#e89800","#c85800"],["#e8e000","#886800","#d8c800","#907800"],["#f828f8","#780078","#e020e0","#880088"],["#00e8f0","#0070a0","#00d0e0","#0080a8"],["#78f800","#007800","#58e000","#008800"],["#7b7b7b","#303030","#6b6b6b","#363636"]],h=[];h[0]=e[0],h[1]=e[6],h[2]=e[2],h[3]=e[3],h[4]=e[4],h[5]=e[7],h[6]=e[5],h[7]=e[1],h[8]=e[8];let{cellSize:o}=n;I.width=o*9,I.height=o;for(let i=0;i<9;i++){let l=i*o;if(c.Block===0)m.fillStyle=s[i][1],m.fillRect(l,0,o,o),m.fillStyle=s[i][3],m.fillRect(l,o/2,o,o/2),m.fillStyle=s[i][0],m.beginPath(),m.moveTo(l,0),m.lineTo(l+o/2,o/2),m.lineTo(l,o),m.fill(),m.fillStyle=s[i][2],m.beginPath(),m.moveTo(l+o,0),m.lineTo(l+o/2,o/2),m.lineTo(l+o,o),m.fill();else if(c.Block===1)m.fillStyle=s[i][0],m.fillRect(l,0,o,o);else if(c.Block===2){let r=Math.max(~~(o*.083),1),g=m.createLinearGradient(l,0,l+o,o);g.addColorStop(.5,t[i][3]),g.addColorStop(1,t[i][4]),m.fillStyle=g,m.fillRect(l,0,o,o),g=m.createLinearGradient(l,0,l+o,o),g.addColorStop(0,t[i][2]),g.addColorStop(.5,t[i][1]),m.fillStyle=g,m.fillRect(l,0,o-r,o-r),g=m.createLinearGradient(l+r,r,l+o-r,o-r),g.addColorStop(0,s[i][0]),g.addColorStop(.5,t[i][0]),g.addColorStop(.5,s[i][0]),g.addColorStop(1,t[i][0]),m.fillStyle=g,m.fillRect(l+r,r,o-r*2,o-r*2)}else if(c.Block===3||c.Block===4){c.Block===4&&(e=h);let r=Math.max(~~(o*.125),1);m.fillStyle=e[i][1],m.fillRect(l,0,o,o),m.fillStyle=e[i][0],m.fillRect(l,0,o,~~(o/2));let g=m.createLinearGradient(l,r,l,o-r);g.addColorStop(0,e[i][2]),g.addColorStop(1,e[i][3]),m.fillStyle=g,m.fillRect(l+r,r,o-r*2,o-r*2),g=m.createLinearGradient(l,r,l,o),g.addColorStop(0,e[i][0]),g.addColorStop(1,e[i][3]),m.fillStyle=g,m.fillRect(l,r,r,o-r),g=m.createLinearGradient(l,0,l,o-r),g.addColorStop(0,e[i][2]),g.addColorStop(1,e[i][1]),m.fillStyle=g,m.fillRect(l+o-r,0,r,o-r)}}}addEventListener("keydown",function(s){[32,37,38,39,40].indexOf(s.keyCode)!==-1&&s.preventDefault(),s.keyCode===p.pause&&(n.paused?te():He()),s.keyCode===p.retry&&q(A),V||(s.keyCode===p.moveLeft?f|=a.moveLeft:s.keyCode===p.moveRight?f|=a.moveRight:s.keyCode===p.moveDown?f|=a.moveDown:s.keyCode===p.hardDrop?f|=a.hardDrop:s.keyCode===p.rotRight||s.keyCode===p.moveUp?f|=a.rotRight:s.keyCode===p.rotLeft?f|=a.rotLeft:s.keyCode===p.rot180?f|=a.rot180:s.keyCode===p.holdPiece&&(f|=a.holdPiece))},!1);addEventListener("keyup",function(s){if(!V){if(s.keyCode===13){if(n.paused)return te();if(n.gameState===9)return q(n.gametype)}s.keyCode===p.moveLeft&&f&a.moveLeft?f^=a.moveLeft:s.keyCode===p.moveRight&&f&a.moveRight?f^=a.moveRight:s.keyCode===p.moveDown&&f&a.moveDown?f^=a.moveDown:s.keyCode===p.hardDrop&&f&a.hardDrop?f^=a.hardDrop:(s.keyCode===p.rotRight||s.keyCode===p.moveUp)&&f&a.rotRight?f^=a.rotRight:s.keyCode===p.rotLeft&&f&a.rotLeft?f^=a.rotLeft:s.keyCode===p.rot180&&f&a.rot180?f^=a.rot180:s.keyCode===p.holdPiece&&f&a.holdPiece&&(f^=a.holdPiece)}},!1);function Ne(){u!==f&&!V?T[R]=f:R in T&&(f=T[R]),!(u&a.holdPiece)&&a.holdPiece&f&&d.hold(),a.rotLeft&f&&!(u&a.rotLeft)?(d.rotate(-1),d.finesse++):a.rotRight&f&&!(u&a.rotRight)?(d.rotate(1),d.finesse++):a.rot180&f&&!(u&a.rot180)&&(d.rotate(1),d.rotate(1),d.finesse++),d.checkShift(),a.moveDown&f&&d.shiftDown(),!(u&a.hardDrop)&&a.hardDrop&f&&d.hardDrop(),d.update(),A!==3?n.lines>=K&&(n.gameState=1,v.innerHTML="YOU WIN!",S(3)):n.digLines.length===0&&(n.gameState=1,v.innerHTML="YOU WIN!",S(3)),u!==f&&(u=f)}function ke(){if(requestAnimationFrame(ke),R++,n.gameState===0)n.paused||Ne(),(d.x!==n.lastX||Math.floor(d.y)!==n.lastY||d.pos!==n.lastPos||d.dirty)&&(k(D),d.drawGhost(),d.draw()),n.lastX=d.x,n.lastY=Math.floor(d.y),n.lastPos=d.pos,d.dirty=!1;else if(n.gameState===2)R<50?v.innerHTML!=="READY"&&(v.innerHTML="READY"):R<100?v.innerHTML!=="GO!"&&(v.innerHTML="GO!"):(v.innerHTML="",n.gameState=0,n.startTime=Date.now(),d.new(E.next())),u!==f&&!V?T[R]=f:R in T&&(f=T[R]),f&a.moveLeft?(u=f,d.shiftDelay=c.DAS,d.shiftReleased=!1,d.shiftDir=-1):f&a.moveRight&&(u=f,d.shiftDelay=c.DAS,d.shiftReleased=!1,d.shiftDir=1);else if(N>=2&&(N===21&&k(D),R%2)){for(let s=0;s<10;s++)L.grid[s][N]&&(L.grid[s][N]=n.gameState-1);L.draw(),N--}}Y();q(0);window.tetris={init:q,menu:S,unpause:te,state:n};})();
//# sourceMappingURL=app.js.map
